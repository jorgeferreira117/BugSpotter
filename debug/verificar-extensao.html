<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Verificador de Extens√£o BugSpotter</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .status-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }
        .success { border-left-color: #28a745; }
        .error { border-left-color: #dc3545; }
        .warning { border-left-color: #ffc107; }
        .info { border-left-color: #17a2b8; }
        
        .check-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        .check-icon {
            font-size: 20px;
            margin-right: 15px;
            min-width: 30px;
        }
        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .instructions {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border-left: 3px solid #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Verificador de Extens√£o BugSpotter</h1>
        <p>Esta ferramenta ajuda a diagnosticar problemas de instala√ß√£o da extens√£o.</p>
        
        <div class="instructions">
            <h3>üìã Antes de come√ßar:</h3>
            <div class="step">
                <strong>1.</strong> Abra <code>chrome://extensions/</code> em uma nova aba
            </div>
            <div class="step">
                <strong>2.</strong> Ative o "Modo do desenvolvedor" (toggle superior direito)
            </div>
            <div class="step">
                <strong>3.</strong> Clique "Carregar sem compacta√ß√£o" e selecione a pasta do projeto
            </div>
            <div class="step">
                <strong>4.</strong> Verifique se "BugSpotter" aparece sem erros
            </div>
            <div class="step">
                <strong>5.</strong> Recarregue esta p√°gina e clique "Verificar Agora"
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button class="btn" onclick="verificarCompleto()">üîç Verificar Agora</button>
            <button class="btn" onclick="limparLogs()">üßπ Limpar Logs</button>
            <button class="btn" onclick="abrirExtensions()">üîß Abrir Extensions</button>
        </div>

        <div id="resultado-verificacao">
            <div class="status-card warning">
                <h3>‚è≥ Aguardando verifica√ß√£o...</h3>
                <p>Clique em "Verificar Agora" para come√ßar o diagn√≥stico.</p>
            </div>
        </div>

        <div>
            <h3>üìã Logs de Diagn√≥stico</h3>
            <div id="logs" class="log-container">
                Aguardando logs...
            </div>
        </div>

        <div id="solucoes" style="display: none;">
            <h3>üõ†Ô∏è Solu√ß√µes Recomendadas</h3>
            <div id="lista-solucoes"></div>
        </div>
    </div>

    <script>
        const logs = [];
        
        function adicionarLog(tipo, mensagem) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push({ tipo, mensagem, timestamp });
            atualizarLogs();
        }

        function atualizarLogs() {
            const container = document.getElementById('logs');
            if (logs.length === 0) {
                container.innerHTML = 'Nenhum log ainda...';
                return;
            }

            container.innerHTML = logs.map(log => {
                const cor = {
                    'info': '#17a2b8',
                    'success': '#28a745',
                    'error': '#dc3545',
                    'warning': '#ffc107'
                }[log.tipo] || '#ffffff';
                
                return `<div style="color: ${cor}; margin: 3px 0;">
                    <span style="color: #aaa;">[${log.timestamp}]</span> 
                    <strong>${(log.tipo || 'LOG').toUpperCase()}:</strong> ${log.mensagem}
                </div>`;
            }).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function verificarCompleto() {
            adicionarLog('info', 'üöÄ Iniciando verifica√ß√£o completa...');
            
            // Aguardar um pouco para a extens√£o carregar
            setTimeout(() => {
                const resultados = {
                    chrome: typeof chrome !== 'undefined',
                    chromeRuntime: typeof chrome !== 'undefined' && typeof chrome.runtime !== 'undefined',
                    chromeStorage: typeof chrome !== 'undefined' && typeof chrome.storage !== 'undefined',
                    storageManager: typeof window.storageManager !== 'undefined' && window.storageManager !== null,
                    bugSpotterContent: typeof window.bugSpotterContent !== 'undefined' && window.bugSpotterContent !== null,
                    BugSpotterContentClass: typeof window.BugSpotterContent !== 'undefined',
                    StorageManagerClass: typeof window.StorageManager !== 'undefined'
                };
                
                // Verifica√ß√£o adicional para detectar se a extens√£o est√° instalada
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                    adicionarLog('info', `üì¶ Extension ID detectado: ${chrome.runtime.id}`);
                } else {
                    adicionarLog('warning', '‚ö†Ô∏è Extension ID n√£o detectado - extens√£o pode n√£o estar carregada');
                }
                
                processarResultados(resultados);
            }, 1000);
        }
        
        function processarResultados(resultados) {

            // Log detalhado de cada verifica√ß√£o
            Object.entries(resultados).forEach(([chave, valor]) => {
                const tipo = valor ? 'success' : 'error';
                const icone = valor ? '‚úÖ' : '‚ùå';
                adicionarLog(tipo, `${icone} ${chave}: ${valor}`);
            });

            // An√°lise dos resultados
            let status = 'success';
            let titulo = '‚úÖ Extens√£o Funcionando Perfeitamente!';
            let descricao = 'Todos os componentes da extens√£o foram detectados.';
            let solucoes = [];

            // Verificar se h√° problemas cr√≠ticos
            const problemasDetectados = Object.values(resultados).some(valor => !valor);
             
            if (!resultados.chrome) {
                status = 'error';
                titulo = '‚ùå Chrome APIs N√£o Dispon√≠veis';
                descricao = 'As APIs do Chrome n√£o est√£o dispon√≠veis. Isso pode indicar que voc√™ n√£o est√° usando o Chrome ou a extens√£o n√£o foi carregada.';
                solucoes.push('üîß Certifique-se de estar usando o Google Chrome');
                solucoes.push('üîß Verifique se a extens√£o est√° instalada e ativada em chrome://extensions/');
                solucoes.push('üîß Certifique-se de que a p√°gina foi carregada via extens√£o ou localhost');
            } else if (!resultados.chromeRuntime || !resultados.chromeStorage) {
                status = 'error';
                titulo = '‚ùå APIs Essenciais Indispon√≠veis';
                descricao = 'Algumas APIs essenciais do Chrome n√£o est√£o dispon√≠veis.';
                solucoes.push('üîÑ Recarregue a extens√£o em chrome://extensions/');
                solucoes.push('üîç Verifique as permiss√µes da extens√£o no manifest.json');
                solucoes.push('üîß Certifique-se de que a extens√£o tem as permiss√µes "storage" e "scripting"');
            } else if (!resultados.StorageManagerClass && !resultados.BugSpotterContentClass) {
                status = 'error';
                titulo = '‚ùå Classes da Extens√£o N√£o Encontradas';
                descricao = 'As classes principais da extens√£o n√£o foram carregadas. Isso indica um problema no content script.';
                solucoes.push('üîÑ Recarregue a extens√£o em chrome://extensions/');
                solucoes.push('üîç Verifique se os arquivos StorageManager.js e content.js existem');
                solucoes.push('üîß Verifique o manifest.json - content_scripts deve incluir ambos os arquivos');
                solucoes.push('üìã Abra o console (F12) e procure por erros de carregamento');
            } else if (!resultados.storageManager || !resultados.bugSpotterContent) {
                status = 'warning';
                titulo = '‚ö†Ô∏è Inst√¢ncias da Extens√£o N√£o Inicializadas';
                descricao = 'As classes est√£o dispon√≠veis, mas as inst√¢ncias n√£o foram criadas. Isso pode ser um problema de timing.';
                solucoes.push('üîÑ Recarregue esta p√°gina e aguarde alguns segundos');
                solucoes.push('üîç Verifique se h√° erros no console (F12)');
                solucoes.push('üîß A extens√£o pode estar carregando - tente aguardar mais tempo');
            }

            // Renderizar resultado
            renderizarResultado(status, titulo, descricao, solucoes, resultados);
            
            adicionarLog('info', '‚úÖ Verifica√ß√£o completa finalizada');
        }
        
        function renderizarResultado(status, titulo, descricao, solucoes, resultados) {
            const container = document.getElementById('resultado-verificacao');
            
            // Criar resumo detalhado dos componentes
            const componentesHtml = Object.entries(resultados).map(([chave, valor]) => {
                const icone = valor ? '‚úÖ' : '‚ùå';
                const classe = valor ? 'success' : 'error';
                const nomeAmigavel = {
                    chrome: 'Chrome APIs',
                    chromeRuntime: 'Chrome Runtime',
                    chromeStorage: 'Chrome Storage',
                    storageManager: 'Storage Manager (inst√¢ncia)',
                    bugSpotterContent: 'BugSpotter Content (inst√¢ncia)',
                    BugSpotterContentClass: 'BugSpotter Content (classe)',
                    StorageManagerClass: 'Storage Manager (classe)'
                }[chave] || chave;
                
                return `<div class="check-item ${classe}">${icone} ${nomeAmigavel}</div>`;
            }).join('');
            
            container.innerHTML = `
                <div class="status-card ${status}">
                    <h3>${titulo}</h3>
                    <p>${descricao}</p>
                    <div style="margin-top: 15px;">
                        <h4>üìã Status dos Componentes:</h4>
                        ${componentesHtml}
                    </div>
                </div>
            `;

            // Mostrar solu√ß√µes se houver problemas
            if (solucoes.length > 0) {
                const solucoesContainer = document.getElementById('solucoes');
                const listaSolucoes = document.getElementById('lista-solucoes');
                
                listaSolucoes.innerHTML = solucoes.map(solucao => 
                    `<div class="check-item warning">${solucao}</div>`
                ).join('');
                
                solucoesContainer.style.display = 'block';
            } else {
                document.getElementById('solucoes').style.display = 'none';
            }
        }

        function limparLogs() {
            logs.length = 0;
            atualizarLogs();
            adicionarLog('info', 'üßπ Logs limpos');
        }

        function abrirExtensions() {
            if (typeof chrome !== 'undefined' && chrome.tabs) {
                chrome.tabs.create({ url: 'chrome://extensions/' });
            } else {
                adicionarLog('warning', '‚ö†Ô∏è N√£o foi poss√≠vel abrir automaticamente. Abra manualmente: chrome://extensions/');
                // Fallback: tentar abrir em nova janela
                window.open('chrome://extensions/', '_blank');
            }
        }

        // Verifica√ß√£o autom√°tica ao carregar
        window.addEventListener('load', () => {
            adicionarLog('info', 'üìÑ P√°gina carregada');
            setTimeout(() => {
                adicionarLog('info', '‚è≥ Aguardando 2 segundos para extens√£o carregar...');
                setTimeout(verificarCompleto, 2000);
            }, 1000);
        });

        // Interceptar logs do console para capturar logs da extens√£o
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('BugSpotter') || message.includes('StorageManager')) {
                adicionarLog('info', `üìù Console: ${message}`);
            }
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            const message = args.join(' ');
            adicionarLog('error', `üö® Erro: ${message}`);
            originalError.apply(console, args);
        };

        console.warn = function(...args) {
            const message = args.join(' ');
            adicionarLog('warning', `‚ö†Ô∏è Aviso: ${message}`);
            originalWarn.apply(console, args);
        };

        adicionarLog('info', 'üîç Verificador iniciado - aguardando verifica√ß√£o...');
    </script>
</body>
</html>